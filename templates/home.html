{% extends "base.html" %}
{% block content %}
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
    {% for video in videos %}
    <div class="group relative">
        <div class="aspect-video bg-[#1E1E1E] rounded-lg overflow-hidden mb-2 border border-[#3C3C3C]">
            <a href="{{ url_for('video_page', video_id=video.id) }}" class="block h-full">
                <video 
                    src="{{ url_for('serve_video', filename=video.filename) }}" 
                    class="w-full h-full object-cover"
                    preload="metadata"
                ></video>
                <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition">
                    <div class="bg-black bg-opacity-50 rounded-full p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        </svg>
                    </div>
                </div>
            </a>
        </div>
        <div class="flex justify-between items-start">
            <div class="flex-1 min-w-0">
                <h3 class="text-sm font-medium truncate">
                    {{ video.title or 'Untitled Video' }}
                </h3>
                <p class="text-xs text-gray-400">
                    {{ video.upload_date.strftime('%b %d, %Y') }}
                </p>
            </div>
            <button 
                onclick="copyFullShareLink({{ video.id }}); event.stopPropagation();" 
                class="ml-2 text-gray-400 hover:text-white"
                title="Share"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                </svg>
            </button>
        </div>
    </div>
    {% endfor %}
</div>

<script>
function copyFullShareLink(videoId) {
    fetch(`/generate_share_link/${videoId}`)
        .then(response => response.json())
        .then(data => {
            navigator.clipboard.writeText(data.share_link).then(() => {
                alert('Link copied to clipboard!');
            });
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to copy link');
        });
    return false;
}
</script>
{% endblock %}